---
import { fetchApi } from "../../lib/api";
import { digitalSecondsDurationFormat } from "../../lib/format";

const { data } = await fetchApi("video-categories", {
  populate: {
    videos: {
      populate: "*",
    },
  },
  pagination: { limit: -1 },
});
---

<section id="videos">
  <h2>Видео 360&deg;</h2>

  {
    data.map((category: any) => (
      <div class="category">
        <h3>{category.name}</h3>

        <div class="container">
          {category.videos.map((video: any) => (
            <div class="frame">
              <h4>{video.title}</h4>
              <span>
                {digitalSecondsDurationFormat.format({
                  minutes: Math.floor(video.durationSeconds / 60),
                  seconds: video.durationSeconds % 60,
                })}
              </span>
              <p>Где находится самое увлекательное видео</p>
            </div>
          ))}
        </div>
      </div>
    ))
  }
</section>

<!-- TODO: fix styling  -->
<style lang="scss">
  section {
    margin-top: 96px;
  }

  .container {
    display: grid;
    grid-template-columns: repeat(
      auto-fit,
      minmax(calc((100% - 32px * 2) / 3), 1fr)
    );
    justify-items: center;
    gap: 0 32px;

    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
  }

  .frame {
    display: grid;
    grid-template-rows: subgrid;
    grid-row: span 3;
    margin-bottom: 32px;
  }

  img {
    border-radius: 32px;
    width: 100%;
    height: 192px;
    object-fit: cover;
  }

  h3,
  p {
    margin: 0;
    padding: 0 8px;
  }

  h3 {
    text-align: left;
  }
</style>
