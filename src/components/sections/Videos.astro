---
import { getAll } from "../../lib/api";
import { digitalSecondsDurationFormat } from "../../lib/format";

const videoCategories = await getAll("video-categories", {
  populate: {
    videos: {
      populate: "*",
    },
  },
  });
---

<section id="videos">
  <h2>Видео 360&deg;</h2>

  {
    await Array.fromAsync(videoCategories, (category: any) => (
      <div class="category">
        <h3>{category.name}</h3>

        <div class="grid">
          {category.videos.map((video: any) => (
            <div class="frame">
              <h4>{video.title}</h4>
              <span>
                {digitalSecondsDurationFormat.format({
                  minutes: Math.floor(video.durationSeconds / 60),
                  seconds: video.durationSeconds % 60,
                })}
              </span>
              <p>Где находится самое увлекательное видео</p>
            </div>
          ))}
        </div>
      </div>
    ))
  }
</section>

<!-- TODO: fix styling  -->
<style lang="scss">
  @use "../../styles/theme";

  .frame {
    display: grid;
    grid-template-rows: subgrid;
    grid-row: span 3;
  }

  img {
    border-radius: 32px;
    width: 100%;
    height: 192px;
    object-fit: cover;
  }

  h3,
  p {
    margin: 0;
    padding: 0 8px;
  }

  h3 {
    text-align: left;
  }
</style>
